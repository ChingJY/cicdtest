name: Notification

on:
  workflow_dispatch:
  push:
    branches: [ 'master', 'release', 'develop' ]

env:
  WORKFLOW_URL: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}

jobs:
    notify:
        runs-on: macos-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: Read versionInfo.txt
              id: read_version
              run: echo "VERSION_NAME=v4.3.5.0928" >> $GITHUB_ENV

            - name: Send notification in develop branch
              uses: ./.github/actions/google-chat-notification-action
              with:
                webhook_url: ${{ secrets.GOOGLE_CHAT_WEBHOOK }}
                title: "Android VoiceTube"
                message: "Android VoiceTube å·²æˆåŠŸæ•´åˆ"
                version_name: ${{ env.VERSION_NAME }}
                key_value_pairs: |
                  AppVersion=${{ env.VERSION_NAME }}
                  Branch=${{ github.ref_name }}
                  Author=${{ github.actor }}
                buttons: |
                  View on GitHub::https://github.com/sashakavun/android-ci-cd

            - name: Send notification in release branch
              uses: ./.github/actions/google-chat-notification-action
              with:
                webhook_url: ${{ secrets.GOOGLE_CHAT_WEBHOOK }}
                title: "Android VoiceTube"
                message: "Android VoiceTube å·²ç™¼å¸ƒæ¸¬è©¦  ğŸ‰"
                version_name: ${{ env.VERSION_NAME }}

            - name: Send notification in master branch
              uses: ./.github/actions/google-chat-notification-action
              with:
                webhook_url: ${{ secrets.GOOGLE_CHAT_WEBHOOK }}
                title: "Android VoiceTube"
                message: "Android VoiceTube å·²ä½ˆç½²è‡³ Google Play Store (Beta)  ğŸš€\nè«‹ç›¸é—œäººå“¡æ³¨æ„ç™¼ç‰ˆ"
                version_name: ${{ env.VERSION_NAME }}
                buttons: |
                    å‰å¾€ Google Play Console ç™¼ç‰ˆ::https://play.google.com/console/u/0/developers/5409789340805974120/app/4972045572799454695/tracks/production
                    å‰å¾€ AppGallery Connect ç™¼ç‰ˆ::https://developer.huawei.com/consumer/cn/service/josp/agc/index.html#/myApp
                    Edit Release Note::https://docs.google.com/spreadsheets/d/1C3-ohBrzsYCMyzzxnY3yis9Fuh84ibge-8M0mAnW1jg/edit#gid=1410907833
                    å‰å¾€ Remote Config å¼·åˆ¶æ›´ç‰ˆ::https://console.firebase.google.com/u/0/project/lithe-window-713/config

            - name: Send failure notification to Google Chat
              if: failure()
              uses: ./.github/actions/google-chat-notification-action
              with:
                title: "Android CICDTest"
                message: "Android CICDTest build failed"
                buttons: |
                  å‰å¾€æŸ¥çœ‹::${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}